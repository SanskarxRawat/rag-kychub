<svg viewBox="0 0 1200 1400" xmlns="http://www.w3.org/2000/svg">
  <!-- Define styles -->
  <defs>
    <style>
      .title { font: bold 28px sans-serif; fill: #1a1a1a; }
      .subtitle { font: bold 18px sans-serif; fill: #2c3e50; }
      .text { font: 14px sans-serif; fill: #2c3e50; }
      .small-text { font: 12px sans-serif; fill: #555; }
      .box { fill: #ffffff; stroke: #2c3e50; stroke-width: 2; }
      .phase-box { fill: #e8f4f8; stroke: #3498db; stroke-width: 2; }
      .component { fill: #f8f9fa; stroke: #495057; stroke-width: 2; }
      .highlight { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
      .storage { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .api { fill: #e8f5e9; stroke: #43a047; stroke-width: 2; }
      .arrow { stroke: #2c3e50; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-blue { stroke: #1976d2; stroke-width: 2; fill: none; marker-end: url(#arrowhead-blue); }
      .arrow-green { stroke: #43a047; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .dashed { stroke-dasharray: 5,5; }
    </style>
    
    <!-- Arrow markers -->
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2c3e50" />
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1976d2" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#43a047" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" class="title">KYCHub RAG System Architecture</text>
  
  <!-- PHASE 1: DATA COLLECTION -->
  <rect x="50" y="80" width="1100" height="220" rx="10" class="phase-box"/>
  <text x="600" y="110" text-anchor="middle" class="subtitle">Phase 1: Data Collection &amp; Indexing</text>
  
  <!-- Web Scraper -->
  <rect x="100" y="130" width="200" height="140" rx="8" class="component"/>
  <text x="200" y="155" text-anchor="middle" class="subtitle">ğŸ•·ï¸ Web Scraper</text>
  <text x="200" y="180" text-anchor="middle" class="small-text">scraper.py</text>
  <text x="110" y="205" class="small-text">â€¢ Priority-based crawling</text>
  <text x="110" y="225" class="small-text">â€¢ Service pages first</text>
  <text x="110" y="245" class="small-text">â€¢ BeautifulSoup parsing</text>
  <text x="110" y="265" class="small-text">â€¢ Max 1000 pages</text>
  
  <!-- Arrow to raw data -->
  <path d="M 300 200 L 380 200" class="arrow"/>
  
  <!-- Raw Data Storage -->
  <rect x="380" y="150" width="180" height="100" rx="8" class="storage"/>
  <text x="470" y="175" text-anchor="middle" class="subtitle">ğŸ“„ Raw Data</text>
  <text x="470" y="200" text-anchor="middle" class="text">raw_pages.jsonl</text>
  <text x="390" y="225" class="small-text">â€¢ URL</text>
  <text x="390" y="240" class="small-text">â€¢ Title, Text</text>
  
  <!-- Arrow to indexer -->
  <path d="M 560 200 L 650 200" class="arrow"/>
  
  <!-- Index Builder -->
  <rect x="650" y="130" width="200" height="140" rx="8" class="component"/>
  <text x="750" y="155" text-anchor="middle" class="subtitle">ğŸ”¨ Index Builder</text>
  <text x="750" y="180" text-anchor="middle" class="small-text">build_index.py</text>
  <text x="660" y="205" class="small-text">â€¢ Smart chunking (800 chars)</text>
  <text x="660" y="225" class="small-text">â€¢ MiniLM-L6-v2 embeddings</text>
  <text x="660" y="245" class="small-text">â€¢ HNSW indexing</text>
  <text x="660" y="265" class="small-text">â€¢ Metadata storage</text>
  
  <!-- Arrow to vector index -->
  <path d="M 850 200 L 930 200" class="arrow"/>
  
  <!-- Vector Index -->
  <rect x="930" y="140" width="190" height="120" rx="8" class="storage"/>
  <text x="1025" y="165" text-anchor="middle" class="subtitle">ğŸ—„ï¸ Vector Index</text>
  <text x="940" y="190" class="small-text">hnsw_index.bin</text>
  <text x="940" y="210" class="small-text">metadatas.jsonl</text>
  <text x="940" y="235" class="small-text">â€¢ Cosine similarity</text>
  <text x="940" y="250" class="small-text">â€¢ Fast retrieval</text>

  <!-- PHASE 2: QUERY PROCESSING -->
  <rect x="50" y="330" width="1100" height="360" rx="10" class="phase-box"/>
  <text x="600" y="360" text-anchor="middle" class="subtitle">Phase 2: Query Processing &amp; Retrieval</text>
  
  <!-- User Query -->
  <rect x="100" y="380" width="160" height="80" rx="8" class="highlight"/>
  <text x="180" y="405" text-anchor="middle" class="subtitle">ğŸ‘¤ User Query</text>
  <text x="180" y="430" text-anchor="middle" class="text">POST /query</text>
  <text x="110" y="450" class="small-text">{"query": "...",</text>
  <text x="110" y="465" class="small-text"> "method": "hybrid"}</text>
  
  <!-- Arrow to Flask API -->
  <path d="M 260 420 L 330 420" class="arrow-green"/>
  
  <!-- Flask API -->
  <rect x="330" y="380" width="160" height="80" rx="8" class="api"/>
  <text x="410" y="405" text-anchor="middle" class="subtitle">ğŸŒ Flask API</text>
  <text x="410" y="430" text-anchor="middle" class="small-text">api.py</text>
  <text x="340" y="450" class="small-text">â€¢ Input validation</text>
  
  <!-- Arrow to RAG Pipeline -->
  <path d="M 410 460 L 410 510" class="arrow-blue"/>
  
  <!-- RAG Pipeline Container -->
  <rect x="290" y="510" width="820" height="160" rx="8" class="component"/>
  <text x="700" y="535" text-anchor="middle" class="subtitle">ğŸ”„ RAG Pipeline (utils.py)</text>
  
  <!-- Step 1: Retrieval -->
  <rect x="310" y="550" width="180" height="100" rx="6" class="highlight"/>
  <text x="400" y="570" text-anchor="middle" class="text">1ï¸âƒ£ Retrieval</text>
  <text x="320" y="590" class="small-text">â€¢ Semantic (embeddings)</text>
  <text x="320" y="605" class="small-text">â€¢ Keyword (BM25)</text>
  <text x="320" y="620" class="small-text">â€¢ Hybrid (combined)</text>
  <text x="320" y="635" class="small-text">Top-K: 10-15 chunks</text>
  
  <!-- Arrow to Reranking -->
  <path d="M 490 600 L 530 600" class="arrow-blue"/>
  
  <!-- Step 2: Reranking -->
  <rect x="530" y="550" width="180" height="100" rx="6" class="highlight"/>
  <text x="620" y="570" text-anchor="middle" class="text">2ï¸âƒ£ Reranking</text>
  <text x="540" y="590" class="small-text">â€¢ URL-based scoring</text>
  <text x="540" y="605" class="small-text">â€¢ Boost service pages</text>
  <text x="540" y="620" class="small-text">â€¢ Penalize blog posts</text>
  <text x="540" y="635" class="small-text">â€¢ Deduplication</text>
  
  <!-- Arrow to Generation -->
  <path d="M 710 600 L 750 600" class="arrow-blue"/>
  
  <!-- Step 3: Generation -->
  <rect x="750" y="550" width="180" height="100" rx="6" class="highlight"/>
  <text x="840" y="570" text-anchor="middle" class="text">3ï¸âƒ£ Generation</text>
  <text x="760" y="590" class="small-text">â€¢ Claude Sonnet 4</text>
  <text x="760" y="605" class="small-text">â€¢ Prompt engineering</text>
  <text x="760" y="620" class="small-text">â€¢ Citation injection</text>
  <text x="760" y="635" class="small-text">â€¢ Grounded responses</text>
  
  <!-- Arrow back to API -->
  <path d="M 840 550 L 840 480 L 490 480 L 490 460" class="arrow-green"/>

  <!-- PHASE 3: RESPONSE -->
  <rect x="50" y="720" width="1100" height="200" rx="10" class="phase-box"/>
  <text x="600" y="750" text-anchor="middle" class="subtitle">Phase 3: Response Generation</text>
  
  <!-- Claude API -->
  <rect x="150" y="770" width="220" height="120" rx="8" class="highlight"/>
  <text x="260" y="795" text-anchor="middle" class="subtitle">ğŸ¤– Claude API</text>
  <text x="260" y="820" text-anchor="middle" class="text">Anthropic Messages API</text>
  <text x="160" y="845" class="small-text">Model: claude-sonnet-4</text>
  <text x="160" y="865" class="small-text">Max tokens: 1000</text>
  <text x="160" y="885" class="small-text">Temperature: 0.0</text>
  
  <!-- Arrow to response -->
  <path d="M 370 830 L 460 830" class="arrow"/>
  
  <!-- Generated Response -->
  <rect x="460" y="770" width="280" height="120" rx="8" class="api"/>
  <text x="600" y="795" text-anchor="middle" class="subtitle">ğŸ“ Generated Response</text>
  <text x="470" y="820" class="small-text">{</text>
  <text x="480" y="840" class="small-text">"answer": "â€¢ Service 1 [1,3]",</text>
  <text x="480" y="860" class="small-text">"retrieved": [{url, text}...],</text>
  <text x="480" y="880" class="small-text">"method": "hybrid"</text>
  <text x="470" y="895" class="small-text">}</text>
  
  <!-- Arrow to user -->
  <path d="M 740 830 L 840 830" class="arrow-green"/>
  
  <!-- User receives response -->
  <rect x="840" y="790" width="180" height="80" rx="8" class="highlight"/>
  <text x="930" y="815" text-anchor="middle" class="subtitle">âœ… User Response</text>
  <text x="850" y="840" class="small-text">Cited answer with:</text>
  <text x="850" y="857" class="small-text">â€¢ Inline citations [1,2]</text>
  <text x="850" y="872" class="small-text">â€¢ Source URLs</text>

  <!-- TECHNOLOGY STACK -->
  <rect x="50" y="950" width="1100" height="180" rx="10" class="component"/>
  <text x="600" y="980" text-anchor="middle" class="subtitle">ğŸ› ï¸ Technology Stack</text>
  
  <!-- Core Libraries Column 1 -->
  <text x="100" y="1010" class="text" font-weight="bold">Data Collection:</text>
  <text x="110" y="1035" class="small-text">â€¢ requests</text>
  <text x="110" y="1055" class="small-text">â€¢ BeautifulSoup4</text>
  <text x="110" y="1075" class="small-text">â€¢ tqdm</text>
  
  <!-- Column 2 -->
  <text x="300" y="1010" class="text" font-weight="bold">Vector Search:</text>
  <text x="310" y="1035" class="small-text">â€¢ hnswlib</text>
  <text x="310" y="1055" class="small-text">â€¢ sentence-transformers</text>
  <text x="310" y="1075" class="small-text">â€¢ numpy</text>
  
  <!-- Column 3 -->
  <text x="530" y="1010" class="text" font-weight="bold">Retrieval:</text>
  <text x="540" y="1035" class="small-text">â€¢ rank-bm25</text>
  <text x="540" y="1055" class="small-text">â€¢ scikit-learn</text>
  <text x="540" y="1075" class="small-text">â€¢ TF-IDF</text>
  
  <!-- Column 4 -->
  <text x="720" y="1010" class="text" font-weight="bold">Generation:</text>
  <text x="730" y="1035" class="small-text">â€¢ anthropic SDK</text>
  <text x="730" y="1055" class="small-text">â€¢ Claude Sonnet 4</text>
  <text x="730" y="1075" class="small-text">â€¢ ujson</text>
  
  <!-- Column 5 -->
  <text x="920" y="1010" class="text" font-weight="bold">API:</text>
  <text x="930" y="1035" class="small-text">â€¢ Flask</text>
  <text x="930" y="1055" class="small-text">â€¢ REST API</text>
  <text x="930" y="1075" class="small-text">â€¢ JSON responses</text>
  
  <!-- File Structure -->
  <rect x="200" y="1110" width="800" height="120" rx="10" class="api"/>
  <text x="600" y="1140" text-anchor="middle" class="subtitle">ğŸ“ Project Structure</text>
  <text x="280" y="1170" class="small-text">â”œâ”€â”€ scraper.py (web crawling)</text>
  <text x="280" y="1190" class="small-text">â”œâ”€â”€ build_index.py (indexing)</text>
  <text x="280" y="1210" class="small-text">â”œâ”€â”€ utils.py (RAG pipeline)</text>
  
  <text x="600" y="1170" class="small-text">â”œâ”€â”€ api.py (Flask REST API)</text>
  <text x="600" y="1190" class="small-text">â”œâ”€â”€ data/raw_pages.jsonl</text>
  <text x="600" y="1210" class="small-text">â””â”€â”€ data/index/ (vectors + metadata)</text>
</svg>
